### ====================================================================
### API Tests - Cuenta Unificada con Abstract Factory Pattern
### ====================================================================
### Descripción:
### Este archivo prueba el endpoint unificado para crear cuentas
### usando el patrón Abstract Factory.
### 
### DTO Utilizado: CuentaDTO (único DTO para todos los tipos de cuenta)
### Endpoint: POST /api/cuenta
### 
### Tipos de cuenta disponibles:
### - CIUDADANO: Público (no requiere autenticación)
### - TECNICO: Protegido (requiere autenticación de admin)
### - OPERADOR_MUNICIPAL: Protegido (requiere autenticación de admin)
### ====================================================================

@baseUrl = http://localhost:8080/api

### ====================================================================
### 1. Obtener tipos de cuenta disponibles
### ====================================================================
GET {{baseUrl}}/cuenta/tipos HTTP/1.1
Content-Type: application/json

### ====================================================================
### 2. Crear CIUDADANO (Público - Sin autenticación)
### ====================================================================
### DTO: CuentaDTO
### Factory: CiudadanoFactory
### ====================================================================
POST {{baseUrl}}/cuenta HTTP/1.1
Content-Type: application/json

{
  "tipoCuenta": "CIUDADANO",
  "usuario": "jperez",
  "contrasena": "password123",
  "nombres": "Juan",
  "apellidos": "Pérez García",
  "dni": "12345678",
  "telefono": "987654321",
  "correo": "juan.perez@email.com",
  "activo": true
}

### ====================================================================
### 3. Crear TECNICO (Protegido - Requiere autenticación)
### ====================================================================
### DTO: CuentaDTO
### Factory: TecnicoFactory
### TODO: Agregar header de autenticación cuando se implemente Spring Security
### ====================================================================
POST {{baseUrl}}/cuenta HTTP/1.1
Content-Type: application/json

{
  "tipoCuenta": "TECNICO",
  "usuario": "mtecnico",
  "contrasena": "tecnico456",
  "nombres": "María",
  "apellidos": "Torres López",
  "dni": "87654321",
  "telefono": "912345678",
  "correo": "maria.torres@municipalidad.gob.pe",
  "activo": true
}

### ====================================================================
### 4. Crear OPERADOR_MUNICIPAL (Protegido - Requiere autenticación)
### ====================================================================
### DTO: CuentaDTO
### Factory: OperadorMunicipalFactory
### TODO: Agregar header de autenticación cuando se implemente Spring Security
### ====================================================================
POST {{baseUrl}}/cuenta HTTP/1.1
Content-Type: application/json

{
  "tipoCuenta": "OPERADOR_MUNICIPAL",
  "usuario": "operador1",
  "contrasena": "operador789",
  "nombres": "Carlos",
  "apellidos": "Ramírez Sánchez",
  "dni": "11223344",
  "telefono": "998877665",
  "correo": "carlos.ramirez@municipalidad.gob.pe",
  "activo": true
}

### ====================================================================
### 5. ❌ Error: Intentar crear con tipo de cuenta inválido
### ====================================================================
### Debe retornar: 400 BAD_REQUEST
### Error: "Tipo de cuenta no válido: ADMINISTRADOR..."
### ====================================================================
POST {{baseUrl}}/cuenta HTTP/1.1
Content-Type: application/json

{
  "tipoCuenta": "ADMINISTRADOR",
  "usuario": "admin",
  "contrasena": "admin123",
  "nombres": "Admin",
  "apellidos": "Sistema",
  "dni": "99999999",
  "telefono": "999999999",
  "correo": "admin@email.com",
  "activo": true
}

### ====================================================================
### 6. ❌ Error: Intentar crear con DNI duplicado
### ====================================================================
### Debe retornar: 400 BAD_REQUEST
### Error: Violación de constraint UNIQUE en campo dni
### NOTA: Ejecutar después del test #2 para que el DNI ya exista
### ====================================================================
POST {{baseUrl}}/cuenta HTTP/1.1
Content-Type: application/json

{
  "tipoCuenta": "CIUDADANO",
  "usuario": "otro_usuario",
  "contrasena": "password123",
  "nombres": "Pedro",
  "apellidos": "González",
  "dni": "12345678",
  "telefono": "987654322",
  "correo": "pedro@email.com",
  "activo": true
}

### ====================================================================
### 7. Crear varios CIUDADANOS válidos
### ====================================================================
POST {{baseUrl}}/cuenta HTTP/1.1
Content-Type: application/json

{
  "tipoCuenta": "CIUDADANO",
  "usuario": "mgarcia",
  "contrasena": "maria123",
  "nombres": "María",
  "apellidos": "García López",
  "dni": "22334455",
  "telefono": "912345679",
  "correo": "maria.garcia@email.com",
  "activo": true
}

###
POST {{baseUrl}}/cuenta HTTP/1.1
Content-Type: application/json

{
  "tipoCuenta": "CIUDADANO",
  "usuario": "lrodriguez",
  "contrasena": "luis456",
  "nombres": "Luis",
  "apellidos": "Rodríguez Martínez",
  "dni": "33445566",
  "telefono": "923456780",
  "correo": "luis.rodriguez@email.com",
  "activo": true
}

###
POST {{baseUrl}}/cuenta HTTP/1.1
Content-Type: application/json

{
  "tipoCuenta": "CIUDADANO",
  "usuario": "aperez",
  "contrasena": "ana789",
  "nombres": "Ana",
  "apellidos": "Pérez Rojas",
  "dni": "44556677",
  "telefono": "934567891",
  "correo": "ana.perez@email.com",
  "activo": true
}

### ====================================================================
### 8. Crear TECNICOS adicionales
### ====================================================================
POST {{baseUrl}}/cuenta HTTP/1.1
Content-Type: application/json

{
  "tipoCuenta": "TECNICO",
  "usuario": "jlopez",
  "contrasena": "tecnico123",
  "nombres": "José",
  "apellidos": "López Fernández",
  "dni": "55667788",
  "telefono": "945678902",
  "correo": "jose.lopez@municipalidad.gob.pe",
  "activo": true
}

###
POST {{baseUrl}}/cuenta HTTP/1.1
Content-Type: application/json

{
  "tipoCuenta": "TECNICO",
  "usuario": "lmartinez",
  "contrasena": "tecnico456",
  "nombres": "Laura",
  "apellidos": "Martínez Castro",
  "dni": "66778899",
  "telefono": "956789013",
  "correo": "laura.martinez@municipalidad.gob.pe",
  "activo": true
}

### ====================================================================
### 9. Crear OPERADORES MUNICIPALES adicionales
### ====================================================================
POST {{baseUrl}}/cuenta HTTP/1.1
Content-Type: application/json

{
  "tipoCuenta": "OPERADOR_MUNICIPAL",
  "usuario": "asanchez",
  "contrasena": "operador456",
  "nombres": "Andrea",
  "apellidos": "Sánchez Díaz",
  "dni": "77889900",
  "telefono": "967890124",
  "correo": "andrea.sanchez@municipalidad.gob.pe",
  "activo": true
}

###
POST {{baseUrl}}/cuenta HTTP/1.1
Content-Type: application/json

{
  "tipoCuenta": "OPERADOR_MUNICIPAL",
  "usuario": "rgarcia",
  "contrasena": "operador789",
  "nombres": "Roberto",
  "apellidos": "García Morales",
  "dni": "88990011",
  "telefono": "978901235",
  "correo": "roberto.garcia@municipalidad.gob.pe",
  "activo": true
}

### ====================================================================
### 10. Validaciones de campos - DNI debe tener 8 dígitos
### ====================================================================
### ❌ Error: DNI inválido (debe tener exactamente 8 dígitos)
### Debe retornar: 400 BAD_REQUEST
### ====================================================================
POST {{baseUrl}}/cuenta HTTP/1.1
Content-Type: application/json

{
  "tipoCuenta": "CIUDADANO",
  "usuario": "test_dni",
  "contrasena": "password123",
  "nombres": "Test",
  "apellidos": "DNI Inválido",
  "dni": "123",
  "telefono": "987654321",
  "correo": "test.dni@email.com",
  "activo": true
}

### ====================================================================
### 11. Validaciones de campos - Correo inválido
### ====================================================================
### ❌ Error: Formato de correo inválido
### Debe retornar: 400 BAD_REQUEST
### ====================================================================
POST {{baseUrl}}/cuenta HTTP/1.1
Content-Type: application/json

{
  "tipoCuenta": "CIUDADANO",
  "usuario": "test_email",
  "contrasena": "password123",
  "nombres": "Test",
  "apellidos": "Email Inválido",
  "dni": "99887766",
  "telefono": "987654321",
  "correo": "correo-invalido",
  "activo": true
}

### ====================================================================
### FIN DE TESTS - Abstract Factory Pattern
### ====================================================================
### Resumen de pruebas:
### ✅ Crear CIUDADANO (público)
### ✅ Crear TECNICO (protegido)
### ✅ Crear OPERADOR_MUNICIPAL (protegido)
### ✅ Obtener tipos de cuenta
### ❌ Tipo de cuenta inválido
### ❌ DNI duplicado
### ❌ Validaciones de campos (DNI, correo)
### ====================================================================
