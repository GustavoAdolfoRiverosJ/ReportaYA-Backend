### ============================================
### Sistema ReportaYA - API REST Tests
### Usar con REST Client extension de VS Code
### ============================================

@baseUrl = http://localhost:8080/api
@contentType = application/json

### ============================================
### CIUDADANOS - Endpoints
### ============================================

### 1. Crear un Ciudadano
POST {{baseUrl}}/ciudadanos
Content-Type: {{contentType}}

{
    "nombres": "Juan Carlos",
    "apellidos": "Pérez García",
    "dni": "72345678",
    "telefono": "987654321",
    "correo": "juan.perez@email.com",
    "usuario": "jperez",
    "contrasena": "pedro"
}

### 2. Listar Todos los Ciudadanos
GET {{baseUrl}}/ciudadanos

### 3. Obtener Ciudadano por ID (cambiar el ID según necesites)
GET {{baseUrl}}/ciudadanos/3

### 4. Buscar Ciudadano por DNI
GET {{baseUrl}}/ciudadanos/dni/70011223

### 5. Actualizar Ciudadano
PUT {{baseUrl}}/ciudadanos/4
Content-Type: {{contentType}}

{
    "nombres": "J",
    "apellidos": "Péía",
    "dni": "72345679",
    "telefono": "99900000",
    "correo": "juan.e.nuevo@email.com",
    "usuario": "jz",
    "contrasena": "password456"
}

### 6. Eliminar Ciudadano (comentado para evitar eliminaciones accidentales)
# DELETE {{baseUrl}}/ciudadanos/1


### ============================================
### REPORTES - Endpoints
### ============================================

### 7. Crear un Reporte con ubicación obligatoria (prioridad MEDIA por defecto)
POST {{baseUrl}}/reportes
Content-Type: {{contentType}}

{
    "titulo": "Fprueba",
    "descripcion": "Hay una gran fuga de agua en la esquina de la Av. Principal con Jr. Los Olivos. El agua está inundando la calle.",
    "cuentaId": 1,
    "ubicacion": {
        "latitud": -12.0850,
        "longitud": -77.0320,
        "direccion": "Av. Principal con Jr. Los Olivos"
    }
}

### 7.1 Crear Reporte CON UBICACIÓN GPS (Latitud y Longitud)
POST {{baseUrl}}/reportes
Content-Type: {{contentType}}

{
    "titulo": "Bache peligroso en Av. Javier Prado",
    "descripcion": "Bache muy grande que puede dañar los vehículos",
    "cuentaId": 1,
    "prioridad": "ALTA",
    "ubicacion": {
        "latitud": -12.0918,
        "longitud": -77.0295,
        "direccion": "Av. Javier Prado Este 4200, San Borja"
    }
}

### 7.2 Crear Reporte CON UBICACIÓN GPS (sin dirección)
POST {{baseUrl}}/reportes
Content-Type: {{contentType}}

{
    "titulo": "Semáforo malogrado",
    "descripcion": "El semáforo no funciona correctamente",
    "cuentaId": 1,
    "prioridad": "MEDIA",
    "ubicacion": {
        "latitud": -12.0464,
        "longitud": -77.0428
    }
}

### 7.3 Crear Reporte CON UBICACIÓN GPS completa (Universidad de Lima)
POST {{baseUrl}}/reportes
Content-Type: {{contentType}}

{
    "titulo": "Iluminación insuficiente en zona peatonal",
    "descripcion": "Falta iluminación en la zona de acceso peatonal",
    "cuentaId": 1,
    "prioridad": "MEDIA",
    "ubicacion": {
        "latitud": -12.0844,
        "longitud": -76.9717,
        "direccion": "Universidad de Lima, Av. Javier Prado Este s/n, Santiago de Surco"
    }
}

### 8. Crear otro Reporte con prioridad MEDIA y ubicación
POST {{baseUrl}}/reportes
Content-Type: {{contentType}}

{
    "titulo": "Bache en Jr. Los Sauces",
    "descripcion": "Hay un bache grande en la pista que puede causar accidentes.",
    "cuentaId": 1,
    "prioridad": "MEDIA",
    "ubicacion": {
        "latitud": -12.0950,
        "longitud": -77.0410,
        "direccion": "Jr. Los Sauces 234"
    }
}

### 9. Crear Reporte con prioridad BAJA y ubicación
POST {{baseUrl}}/reportes
Content-Type: {{contentType}}

{
    "titulo": "Alumbrado público apagado",
    "descripcion": "El poste de luz en la esquina no enciende desde hace 3 días.",
    "cuentaId": 1,
    "prioridad": "BAJA",
    "ubicacion": {
        "latitud": -12.0780,
        "longitud": -77.0380
    }
}

### 10. Listar Todos los Reportes
GET {{baseUrl}}/reportes

### 11. Obtener Reporte por ID
GET {{baseUrl}}/reportes/1

### 12. Obtener Reportes de un Ciudadano específico
GET {{baseUrl}}/reportes/cuenta/1

### 13. Obtener Reportes por Estado - PENDIENTE
GET {{baseUrl}}/reportes/estado/PENDIENTE

### 14. Obtener Reportes por Estado - REVISION
GET {{baseUrl}}/reportes/estado/REVISION

### 15. Obtener Reportes por Estado - PROCESO
GET {{baseUrl}}/reportes/estado/PROCESO

### 16. Obtener Reportes por Estado - FINALIZADO
GET {{baseUrl}}/reportes/estado/FINALIZADO

### 17. Obtener Reportes por Estado - RECHAZADO
GET {{baseUrl}}/reportes/estado/RECHAZADO

### 18. Actualizar Reporte Completo
PUT {{baseUrl}}/reportes/1
Content-Type: {{contentType}}

{
    "titulo": "Fuga de agua en Av. Principal (ACTUALIZADO)",
    "descripcion": "La fuga de agua ha empeorado. Se requiere atención urgente inmediata.",
    "prioridad": "ALTA"
}

### 18.1 Actualizar Reporte CON Nueva Ubicación GPS
PUT {{baseUrl}}/reportes/1
Content-Type: {{contentType}}

{
    "titulo": "Fuga de agua - ubicación corregida",
    "descripcion": "La fuga está en una ubicación diferente a la reportada inicialmente",
    "prioridad": "ALTA",
    "ubicacion": {
        "latitud": -12.0950,
        "longitud": -77.0300,
        "direccion": "Av. Principal 123, San Isidro"
    }
}

### 19. Cambiar Estado de Reporte a REVISION
PATCH {{baseUrl}}/reportes/1/estado?nuevoEstado=REVISION

### 20. Cambiar Estado de Reporte a PROCESO
PATCH {{baseUrl}}/reportes/1/estado?nuevoEstado=PROCESO

### 21. Cambiar Estado de Reporte a FINALIZADO
PATCH {{baseUrl}}/reportes/1/estado?nuevoEstado=FINALIZADO

### 22. Cambiar Estado de Reporte a RECHAZADO
PATCH {{baseUrl}}/reportes/1/estado?nuevoEstado=RECHAZADO

### 23. Cambiar Prioridad de Reporte a ALTA
PATCH {{baseUrl}}/reportes/1/prioridad?nuevaPrioridad=ALTA

### 24. Cambiar Prioridad de Reporte a MEDIA
PATCH {{baseUrl}}/reportes/1/prioridad?nuevaPrioridad=MEDIA

### 25. Cambiar Prioridad de Reporte a BAJA
PATCH {{baseUrl}}/reportes/1/prioridad?nuevaPrioridad=BAJA

### 26. Eliminar Reporte (comentado para evitar eliminaciones accidentales)
# DELETE {{baseUrl}}/reportes/1


### ============================================
### FLUJO COMPLETO DE PRUEBA
### ============================================

### PASO 1: Crear un Ciudadano
POST {{baseUrl}}/ciudadanos
Content-Type: {{contentType}}

{
    "nombres": "María",
    "apellidos": "González López",
    "dni": "87654321",
    "telefono": "912345678",
    "correo": "maria.gonzalez@email.com",
    "usuario": "mgonzalez",
    "contrasena": "maria123"
}

### PASO 2: Crear un Reporte para ese Ciudadano (usar el ID del paso anterior)
POST {{baseUrl}}/reportes
Content-Type: {{contentType}}

{
    "titulo": "Basura acumulada en esquina",
    "descripcion": "Hay basura acumulada que no se ha recogido en 5 días.",
    "cuentaId": 2,
    "prioridad": "MEDIA",
    "ubicacion": {
        "latitud": -12.1200,
        "longitud": -77.0350,
        "direccion": "Jr. Los Pinos 456, Miraflores"
    }
}

### PASO 3: Ver todos los reportes del ciudadano
GET {{baseUrl}}/reportes/cuenta/3

### PASO 4: Cambiar estado del reporte a REVISION
PATCH {{baseUrl}}/reportes/2/estado?nuevoEstado=REVISION

### PASO 5: Cambiar estado del reporte a PROCESO
PATCH {{baseUrl}}/reportes/2/estado?nuevoEstado=PROCESO

### PASO 6: Cambiar prioridad del reporte a ALTA
PATCH {{baseUrl}}/reportes/2/prioridad?nuevaPrioridad=ALTA

### PASO 7: Cambiar estado del reporte a FINALIZADO
PATCH {{baseUrl}}/reportes/2/estado?nuevoEstado=FINALIZADO

### PASO 8: Verificar el reporte finalizado
GET {{baseUrl}}/reportes/2


### ============================================
### PRUEBAS DE VALIDACIÓN Y ERRORES
### ============================================

### Buscar Ciudadano que no existe
GET {{baseUrl}}/ciudadanos/9999

### Buscar Reporte que no existe
GET {{baseUrl}}/reportes/9999

### Crear Reporte sin cuentaId (debería fallar)
POST {{baseUrl}}/reportes
Content-Type: {{contentType}}

{
    "titulo": "Reporte sin ciudadano",
    "descripcion": "Este reporte no tiene cuentaId",
    "prioridad": "ALTA",
    "ubicacion": {
        "latitud": -12.0700,
        "longitud": -77.0500
    }
}

### Crear Reporte con cuentaId inexistente (debería fallar)
POST {{baseUrl}}/reportes
Content-Type: {{contentType}}

{
    "titulo": "Reporte con ciudadano inexistente",
    "descripcion": "Este reporte tiene un cuentaId que no existe",
    "cuentaId": 9999,
    "prioridad": "ALTA",
    "ubicacion": {
        "latitud": -12.0700,
        "longitud": -77.0500
    }
}

### Crear Reporte SIN ubicación (debería fallar - ubicación obligatoria)
POST {{baseUrl}}/reportes
Content-Type: {{contentType}}

{
    "titulo": "Reporte sin ubicación GPS",
    "descripcion": "Este reporte debe fallar porque no tiene ubicación",
    "cuentaId": 1,
    "prioridad": "ALTA"
}

### Crear Reporte con ubicación incompleta - sin latitud (debería fallar)
POST {{baseUrl}}/reportes
Content-Type: {{contentType}}

{
    "titulo": "Reporte con ubicación incompleta",
    "descripcion": "Este reporte debe fallar porque falta la latitud",
    "cuentaId": 1,
    "prioridad": "ALTA",
    "ubicacion": {
        "longitud": -77.0500
    }
}

### Crear Reporte con ubicación incompleta - sin longitud (debería fallar)
POST {{baseUrl}}/reportes
Content-Type: {{contentType}}

{
    "titulo": "Reporte con ubicación incompleta",
    "descripcion": "Este reporte debe fallar porque falta la longitud",
    "cuentaId": 1,
    "prioridad": "ALTA",
    "ubicacion": {
        "latitud": -12.0700
    }
}


### ============================================
### PRUEBAS DE UBICACIÓN GPS
### ============================================

### GPS 1: Reporte en Miraflores (Parque Kennedy)
POST {{baseUrl}}/reportes
Content-Type: {{contentType}}

{
    "titulo": "Bancas deterioradas en Parque Kennedy",
    "descripcion": "Las bancas del parque necesitan reparación",
    "cuentaId": 1,
    "prioridad": "BAJA",
    "ubicacion": {
        "latitud": -12.1209,
        "longitud": -77.0295,
        "direccion": "Parque Kennedy, Miraflores"
    }
}

### GPS 2: Reporte en San Isidro (Óvalo Gutiérrez)
POST {{baseUrl}}/reportes
Content-Type: {{contentType}}

{
    "titulo": "Semáforo con fallas intermitentes",
    "descripcion": "El semáforo peatonal no funciona correctamente",
    "cuentaId": 1,
    "prioridad": "ALTA",
    "ubicacion": {
        "latitud": -12.0972,
        "longitud": -77.0333,
        "direccion": "Óvalo Gutiérrez, San Isidro"
    }
}

### GPS 3: Reporte en Surco (Wong Chacarilla)
POST {{baseUrl}}/reportes
Content-Type: {{contentType}}

{
    "titulo": "Veredas rotas cerca de supermercado",
    "descripcion": "Veredas en mal estado representan peligro para peatones",
    "cuentaId": 1,
    "prioridad": "MEDIA",
    "ubicacion": {
        "latitud": -12.1056,
        "longitud": -76.9817
    }
}

### GPS 4: Reporte SIN ubicación (DEBE FALLAR - ubicación obligatoria)
POST {{baseUrl}}/reportes
Content-Type: {{contentType}}

{
    "titulo": "Problema general sin ubicación específica",
    "descripcion": "Este reporte DEBE FALLAR porque la ubicación es obligatoria",
    "cuentaId": 1,
    "prioridad": "BAJA"
}

### GPS 5: Actualizar reporte agregando ubicación
PUT {{baseUrl}}/reportes/3
Content-Type: {{contentType}}

{
    "titulo": "Problema ahora con ubicación",
    "descripcion": "Se agrega ubicación GPS al reporte",
    "prioridad": "MEDIA",
    "ubicacion": {
        "latitud": -12.0700,
        "longitud": -77.0500,
        "direccion": "Ubicación agregada posteriormente"
    }
}

### GPS 6: Ver reporte con ubicación (cambiar ID según necesites)
GET {{baseUrl}}/reportes/1


### ============================================
### VALORES PERMITIDOS
### ============================================

# Estados de Reporte:
# - PENDIENTE (por defecto al crear)
# - REVISION
# - PROCESO
# - FINALIZADO
# - RECHAZADO

# Prioridades:
# - BAJA
# - MEDIA (por defecto al crear)
# - ALTA

# Ubicación GPS (OBLIGATORIA):
# - ubicacion: Object (OBLIGATORIO) - No se puede crear un reporte sin ubicación
# - latitud: Double (OBLIGATORIO) - Coordenada de latitud (ej: -12.0464)
# - longitud: Double (OBLIGATORIO) - Coordenada de longitud (ej: -77.0428)
# - direccion: String (opcional) - Dirección legible del lugar


### ============================================
### NOTAS DE USO
### ============================================

# 1. Asegúrate de que el servidor esté corriendo en http://localhost:8080
# 2. Instala la extensión "REST Client" en VS Code
# 3. Haz clic en "Send Request" sobre cada petición
# 4. Los IDs (1, 2, etc.) son ejemplos, ajústalos según tus datos
# 5. Las peticiones DELETE están comentadas para evitar eliminaciones accidentales
# 6. Ejecuta las peticiones en orden para seguir el flujo completo
# 7. La ubicación GPS es OBLIGATORIA al crear un reporte (composición)
# 8. Las coordenadas GPS (latitud y longitud) son obligatorias
# 9. La dirección en la ubicación es opcional
